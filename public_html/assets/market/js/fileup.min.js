!function(e){var t={url:window.location.pathname+window.location.search,inputID:"",queueID:"",dropzoneID:"",files:[],fieldName:"filedata",extraFields:{},lang:"en",sizeLimit:0,filesLimit:0,method:"post",timeout:null,autostart:!1,templateFile:'<div id="fileup-[INPUT_ID]-[FILE_NUM]" class="fileup-file [TYPE]"><div class="fileup-preview"><img src="[PREVIEW_SRC]" alt="[NAME]"/></div><div class="fileup-container"><div class="fileup-description"><span class="fileup-name">[NAME]</span> (<span class="fileup-size">[SIZE_HUMAN]</span>)</div><div class="fileup-controls"><span class="fileup-remove" onclick="$.fileup(\'[INPUT_ID]\', \'remove\', \'[FILE_NUM]\');" title="[REMOVE]"></span><span class="fileup-upload" onclick="$.fileup(\'[INPUT_ID]\', \'upload\', \'[FILE_NUM]\');">[UPLOAD]</span><span class="fileup-abort" onclick="$.fileup(\'[INPUT_ID]\', \'abort\', \'[FILE_NUM]\');" style="display:none">[ABORT]</span></div><div class="fileup-result"></div><div class="fileup-progress"><div class="fileup-progress-bar"></div></div></div><div class="fileup-clear"></div></div>',onSelect:function(e){},onRemove:function(e,t,i){},onBeforeStart:function(e,t,i){},onBeforeRender:function(){},onAfterRender:function(){},onStart:function(e,t){},onStartSystem:function(t,i){var n=this.fileup.options,r=e("#fileup-"+n.inputID+"-"+t);r.find(".fileup-controls .fileup-upload").hide(),r.find(".fileup-controls .fileup-abort").show(),r.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onProgress:function(t,i,n){if(i.lengthComputable){var r=this.fileup.options,l=Math.ceil(i.loaded/i.total*100);e("#fileup-"+r.inputID+"-"+t+" .fileup-progress-bar").css("width",l+"%")}},onSuccess:function(e,t,i){},onError:function(e,t,i,n){},onErrorSystem:function(t,i,n){var l=this.fileup.options;switch(t){case"files_limit":var o=r[l.lang].errorFilesLimit;alert(o.replace(/%filesLimit%/g,l.filesLimit));break;case"size_limit":var a=f(l.sizeLimit);o=(o=(o=r[l.lang].errorSizeLimit).replace(/%sizeLimit%/g,a)).replace(/%fileName%/g,i.name),alert(o);break;case"file_type":o=r[l.lang].errorFileType;alert(o.replace(/%fileName%/g,i.name));break;case"bad_status":case"error_load":var s=e("#fileup-"+l.inputID+"-"+n);s.find(".fileup-controls .fileup-abort").hide(),s.find(".fileup-controls .fileup-upload").show(),s.find(".fileup-result").addClass("fileup-error").text(r[l.lang].error);break;case"old_browser":alert(r[l.lang].errorOldBrowser)}},onAbort:function(e,t){},onAbortSystem:function(t,i){var n=this.fileup.options,r=e("#fileup-"+n.inputID+"-"+t);r.find(".fileup-controls .fileup-abort").hide(),r.find(".fileup-controls .fileup-upload").show(),r.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onTimeout:function(e,t){},onTimeoutSystem:function(t,i){var n=this.fileup.options,r=e("#fileup-"+n.inputID+"-"+t);r.find(".fileup-controls .fileup-abort").hide(),r.find(".fileup-controls .fileup-upload").show(),r.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text("")},onFinish:function(e,t){},onSuccessSystem:function(t,i,n){var l=this.fileup.options,o=e("#fileup-"+l.inputID+"-"+i);o.find(".fileup-controls .fileup-abort").hide(),o.find(".fileup-controls .fileup-upload").hide(),o.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(r[l.lang].complete)},onDragOver:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDragLeave:function(e){},onDragEnd:function(e){},onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},i={addEvent:function(e,t,i){var n=e.fileup.events[t]||[];n.push(i),e.fileup.events[t]=n},removeEvents:function(e,t){e.fileup.events[t]=[]},callEvent:function(e,t,i){var n,r=!0;if(e.fileup.events[t])for(var l=0;l<e.fileup.events[t].length;l++)"function"==typeof e.fileup.events[t][l]&&(i?(n=e.fileup.events[t][l].apply(e,i),r&&!1===n&&(r=!1)):(n=e.fileup.events[t][l].apply(e),r&&!1===n&&(r=!1)));return r}},n={input:{},select:function(e){return i.addEvent(n.input,"select",e),n},remove:function(e){return i.addEvent(n.input,"remove",e),n},beforeStart:function(e){return i.addEvent(n.input,"beforeStart",e),n},start:function(e){return i.addEvent(n.input,"start",e),n},progress:function(e){return i.addEvent(n.input,"progress",e),n},success:function(e){return i.addEvent(n.input,"success",e),n},error:function(e){return i.addEvent(n.input,"error",e),n},abort:function(e){return i.addEvent(n.input,"abort",e),n},timeout:function(e){return i.addEvent(n.input,"timeout",e),n},dragOver:function(e){return i.addEvent(n.input,"dragOver",e),n},dragLeave:function(e){return i.addEvent(n.input,"dragLeave",e),n},dragEnd:function(e){return i.addEvent(n.input,"dragEnd",e),n},dragEnter:function(e){return i.addEvent(n.input,"dragEnter",e),n}},r={ru:{upload:"Загрузить",abort:"Остановить",remove:"Удалить",complete:"Готово",error:"Ошибка",errorFilesLimit:"Количество выбранных файлов превышает лимит (%filesLimit%)",errorSizeLimit:'Файл "%fileName%" превышает предельный размер (%sizeLimit%)',errorFileType:'Файл "%fileName%" является некорректным',errorOldBrowser:"Ваш браузер не может загружать файлы. Обновите его до последней версии"},en:{upload:"Upload",abort:"Abort",remove:"Remove",complete:"Complete",error:"Error",errorFilesLimit:"The number of selected files exceeds the limit (%filesLimit%)",errorSizeLimit:'File "%fileName%" exceeds the size limit (%sizeLimit%)',errorFileType:'File "%fileName%" is incorrect',errorOldBrowser:"Your browser can not upload files. Update to the latest version"}};function l(t){t.preventDefault(),t.stopPropagation();var n=t.target.fileup.input,r=n.fileup.options,l=t.target.files||t.dataTransfer.files;if(l.length){i.callEvent(n,"beforeRender");for(var o=0;o<l.length;o++){var f=l[o];if(r.sizeLimit>0&&s(f)>r.sizeLimit)i.callEvent(n,"error",["size_limit",f]);else{if(r.filesLimit>0&&Object.keys(l).length>=r.filesLimit){i.callEvent(n,"error",["files_limit",f]);break}if("string"==typeof n.accept){var u=n.accept;if(u&&/[^\w]+/.test(u)){var p=!1,d=u.split(",");if(d.length>0)for(var c=0;c<d.length;c++)if(d[c]=d[c].replace(/\s/g,""),new RegExp(d[c].replace("*",".*")).test(f.type)||new RegExp(d[c].replace(".",".*/")).test(f.type)){p=!0;break}if(!p){i.callEvent(n,"error",["file_type",f]);continue}}}!1!==i.callEvent(n,"select",[f])&&a(f,n)}}e(n).val(""),i.callEvent(n,"afterRender")}i.callEvent(n,"dragEnd",[t])}function o(){if(this.files.length){var t=this.fileup.options;if(!e(this).is("[multiple]")){if(!i.callEvent(this,"remove",["*","1",this.files[0]]))return void e(this).val("");e("#"+t.queueID).empty(),this.fileup.files={}}i.callEvent(this,"beforeRender");for(var n=0;n<this.files.length;n++){var r=this.files[n];if(t.sizeLimit>0&&s(r)>t.sizeLimit)i.callEvent(this,"error",["size_limit",r]);else{if(t.filesLimit>0&&Object.keys(this.fileup.files).length>=t.filesLimit){i.callEvent(this,"error",["files_limit",r]);break}if("string"==typeof this.accept){var l=this.accept;if(l&&/[^\w]+/.test(l)){var o=!1,f=l.split(",");if(f.length>0)for(var u=0;u<f.length;u++)if(f[u]=f[u].replace(/\s/g,""),new RegExp(f[u].replace("*",".*")).test(r.type)||new RegExp(f[u].replace(".",".*/")).test(r.type)){o=!0;break}if(!o){i.callEvent(this,"error",["file_type",r]);continue}}}!1!==i.callEvent(this,"select",[r])&&a(r,this)}}e(this).val(""),i.callEvent(this,"afterRender")}}function a(t,n){var l=n.fileup.options;if(window.XMLHttpRequest)var o="onload"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;else{if(!window.ActiveXObject)return i.callEvent(n,"error",["old_browser",t]),!1;try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return i.callEvent(n,"error",["old_browser",t]),!1}}}var a=l.templateFile;a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/\[INPUT_ID\]/g,l.inputID)).replace(/\[FILE_NUM\]/g,n.fileup.nextID)).replace(/\[NAME\]/g,function(e){return e.name||e.fileName}(t))).replace(/\[MTYPE\]/g,t.type)).replace(/\[SIZE\]/g,s(t))).replace(/\[SIZE_HUMAN\]/g,f(s(t)))).replace(/\[UPLOAD\]/g,r[l.lang].upload)).replace(/\[REMOVE\]/g,r[l.lang].remove)).replace(/\[ABORT\]/g,r[l.lang].abort);var p={xhr:o,file:t,file_number:n.fileup.nextID,status:"stand_by"};if(n.fileup.files[n.fileup.nextID]=p,n.fileup.nextID++,"image/gif"===t.type||"image/png"===t.type||"image/jpg"===t.type||"image/jpeg"===t.type)if("undefined"!=typeof FileReader){var d=new FileReader;d.onload=function(t){a=(a=a.replace(/\[PREVIEW_SRC\]/g,t.target.result)).replace(/\[TYPE\]/g,"fileup-image"),e("#"+l.queueID).append(a),l.autostart&&u(n,p)},d.readAsDataURL(t)}else a=(a=a.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-image fileup-no-preview"),e("#"+l.queueID).append(a),l.autostart&&u(n,p);else a=(a=a.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),e("#"+l.queueID).append(a),l.autostart&&u(n,p)}function s(e){return e.size||e.fileSize}function f(e){var t="";return e>=1073741824?t=(e/1073741824).toFixed(2)+" Gb":e>=1048576?t=(e/1048576).toFixed(2)+" Mb":e>=1024?t=(e/1024).toFixed(2)+" Kb":e>=0&&(t=e+" bytes"),t}function u(t,n){var r=t.fileup.options,l=n.file_number,o=n.file,a=n.xhr;if("number"==typeof r.timeout&&(a.timeout=r.timeout),a.onloadstart=function(){n.status="loading",i.callEvent(t,"start",[l,o])},a.upload.onprogress=function(e){i.callEvent(t,"progress",[l,e,o])},a.onload=function(){n.status="loaded",200===a.status?i.callEvent(t,"success",[a.responseText,l,o]):i.callEvent(t,"error",["bad_status",o,l,a.responseText])},a.onloadend=function(){i.callEvent(t,"finish",[l,o])},a.onabort=function(){n.status="stand_by",i.callEvent(t,"abort",[l,o])},a.ontimeout=function(){n.status="stand_by",i.callEvent(t,"timeout",[l,o])},a.onerror=function(e){n.status="stand_by",i.callEvent(t,"error",["error_load",o,l,e])},a.open(r.method,r.url,!0),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.callEvent(t,"beforeStart",[a,l,o]),void 0!==window.FormData){var s=new FormData;return s.append(r.fieldName,o),Object.keys(r.extraFields).length&&e.each(r.extraFields,function(e,t){s.append(e,t)}),a.send(s)}return a.send(o)}var p={appendFile:function(e,t){a(t,document.getElementById(e))},upload:function(t,i){var n=document.getElementById(t);n&&"file"===n.type&&"object"==typeof n.fileup&&("*"===i?e.each(n.fileup.files,function(e,t){"stand_by"===t.status&&u(n,t)}):"object"==typeof n.fileup.files[i]&&u(n,n.fileup.files[i]))},remove:function(t,n){var r=document.getElementById(t);if(r&&"file"===r.type&&"object"==typeof r.fileup){r.fileup.options;var l=Object.keys(r.fileup.files).length;if("*"===n){if(!1===i.callEvent(r,"remove",["*",l]))return;r.fileup.files={},e("[id^=fileup-"+t+"-]").fadeOut("fast",function(){e(this).remove()})}else if("object"==typeof r.fileup.files[n]){if(!1===i.callEvent(r,"remove",[r.fileup.files[n],l,n]))return;delete r.fileup.files[n],e("#fileup-"+t+"-"+n).fadeOut("fast",function(){e(this).remove()})}}},removeEvents:function(e,t){var n=document.getElementById(e);n&&"file"===n.type&&"object"==typeof n.fileup&&i.removeEvents(n,t)},abort:function(t,i){var n=document.getElementById(t);n&&"file"===n.type&&"object"==typeof n.fileup&&("*"===i?e.each(n.fileup.files,function(e,t){t.xhr.abort()}):"object"==typeof n.fileup.files[i]&&n.fileup.files[i].xhr.abort())}};e.fileup=function(a,s,u){if("object"==typeof a){if(function(n){var a=e.extend(!1,t,n),s=document.getElementById(a.inputID);if(s&&"file"===s.type){if(a.dropzoneID){var u=document.getElementById(a.dropzoneID);u&&(u.addEventListener("dragover",function(e){i.callEvent(s,"dragOver",[e])}),u.addEventListener("dragleave",function(e){i.callEvent(s,"dragLeave",[e])}),u.addEventListener("dragenter",function(e){i.callEvent(s,"dragEnter",[e])}),u.addEventListener("drop",l),u.fileup={input:s})}if(s.fileup={files:{},nextID:0,options:a,events:{}},i.addEvent(s,"select",a.onSelect),i.addEvent(s,"remove",a.onRemove),i.addEvent(s,"beforeStart",a.onBeforeStart),i.addEvent(s,"beforeRender",a.onBeforeRender),i.addEvent(s,"afterRender",a.onAfterRender),i.addEvent(s,"start",a.onStartSystem),i.addEvent(s,"start",a.onStart),i.addEvent(s,"progress",a.onProgress),i.addEvent(s,"success",a.onSuccessSystem),i.addEvent(s,"success",a.onSuccess),i.addEvent(s,"error",a.onErrorSystem),i.addEvent(s,"error",a.onError),i.addEvent(s,"abort",a.onAbortSystem),i.addEvent(s,"abort",a.onAbort),i.addEvent(s,"timeout",a.onTimeoutSystem),i.addEvent(s,"timeout",a.onTimeout),i.addEvent(s,"dragOver",a.onDragOver),i.addEvent(s,"dragLeave",a.onDragLeave),i.addEvent(s,"dragEnd",a.onDragEnd),i.addEvent(s,"dragEnter",a.onDragEnter),e(s).on("change",o),a.files.length>0){i.callEvent(s,"beforeRender");for(var p=0;p<a.files.length;p++){var d=a.templateFile;if(d=(d=(d=(d=(d=(d=(d=d.replace(/\[INPUT_ID\]/g,a.inputID)).replace(/\[FILE_NUM\]/g,s.fileup.nextID)).replace(/\[NAME\]/g,a.files[p].name)).replace(/\[SIZE_HUMAN\]/g,f(a.files[p].size))).replace(/\[UPLOAD\]/g,r[a.lang].upload)).replace(/\[REMOVE\]/g,r[a.lang].remove)).replace(/\[ABORT\]/g,r[a.lang].abort),s.fileup.files[s.fileup.nextID]={xhr:null,file:a.files[p],file_number:s.fileup.nextID,status:"loaded"},d=a.files[p].previewUrl?(d=d.replace(/\[PREVIEW_SRC\]/g,a.files[p].previewUrl)).replace(/\[TYPE\]/g,"fileup-image"):(d=d.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),e("#"+a.queueID).append(d).find(".fileup-progress, .fileup-result, .fileup-upload, .fileup-abort").remove(),a.files[p].downloadUrl){var c=e("#fileup-"+a.inputID+"-"+s.fileup.nextID).find(".fileup-name");c[0]&&c.replaceWith('<a href="'+a.files[p].downloadUrl+'" class="fileup-name" download="'+a.files[p].name+'">'+a.files[p].name+"</a>")}s.fileup.nextID++}i.callEvent(s,"afterRender")}}}(a),(d=document.getElementById(a.inputID))&&"file"===d.type&&"object"==typeof d.fileup)return n.input=d,n}else if("string"==typeof a&&"string"==typeof s&&"function"==typeof p[s])p[s](a,u);else if("string"==typeof a&&void 0===s&&void 0===u){var d;if((d=document.getElementById(a))&&"file"===d.type&&"object"==typeof d.fileup)return n.input=d,n}else e.error("Unknown method "+a)}}(jQuery);